---
ms.openlocfilehash: 3e62289181d994a0e786bb53417f576ac1a3059b
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051536"
---
# <a name="azure-cosmos-db-client-library-for-javascripttypescript"></a>Azure Cosmos DB-Clientbibliothek für JavaScript/TypeScript

[![neuestes npm-Badge](https://img.shields.io/npm/v/%40azure%2Fcosmos/latest.svg)][npm]
[![Buildstatus](https://dev.azure.com/azure-sdk/public/_apis/build/status/js/js%20-%20cosmosdb%20-%20ci?branchName=main)](https://dev.azure.com/azure-sdk/public/_build/latest?definitionId=850&branchName=main)

Azure Cosmos DB ist ein global verteilter Datenbankdienst mit mehreren Modellen, der Datenbanken mit Dokumenten, Schlüsselwerten, breiten Spalten und Graphen unterstützt. Dieses Paket ist für JavaScript/TypeScript-Anwendungen vorgesehen, um mit **SQL API**-Datenbanken und den JSON-Dokumenten zu interagieren, die darin enthalten sind:

- Erstellen von Cosmos DB-Datenbanken und Ändern ihrer Einstellungen
- Erstellen und Ändern von Containern zum Speichern von Sammlungen von JSON-Dokumenten
- Erstellen, Lesen, Aktualisieren und Löschen der Elemente (JSON-Dokumente) in Ihren Containern
- Abfragen der Dokumente in Ihrer Datenbank mithilfe von SQL-ähnlicher Syntax

Wichtige Links:

- [Paket (npm)][npm]
- [API-Referenzdokumentation](https://docs.microsoft.com/javascript/api/@azure/cosmos/?view=azure-node-lates)
- [Produktdokumentation][cosmos_docs]

## <a name="getting-started"></a>Erste Schritte

### <a name="prerequisites"></a>Voraussetzungen

#### <a name="azure-subscription-and-cosmos-db-sql-api-account"></a>Azure-Abonnement und Cosmos DB-SQL-API-Konto

Sie müssen ein [Azure-Abonnement][azure_sub] und ein [Cosmos DB-Konto][cosmos_account] (SQL API) haben, um dieses Paket verwenden zu können.

Wenn Sie ein Cosmos DB-SQL-API-Konto benötigen, können Sie eines über die Azure [Cloud Shell][cloud_shell_bash] mit diesem Azure CLI-Befehl erstellen:

```Bash
az cosmosdb create --resource-group <resource-group-name> --name <cosmos-database-account-name>
```

Oder Sie können ein Konto im [Azure-Portal](https://portal.azure.com/#create/microsoft.documentdb) erstellen.

#### <a name="nodejs"></a>NodeJS

Dieses Paket wird über [npm][npm] verteilt, das mit [NodeJS](https://nodejs.org/en/) vorinstalliert wurde. Sie sollten Node v10 oder höher verwenden.

#### <a name="cors"></a>CORS

Sie müssen Regeln zur [Ressourcenfreigabe zwischen verschiedenen Ursprüngen (Cross-Origin Resource Sharing, CORS)](https://docs.microsoft.com/azure/cosmos-db/how-to-configure-cross-origin-resource-sharing) für Ihr Cosmos DB-Konto einrichten, wenn Sie für Browser entwickeln müssen. Folgen Sie den Anleitungen im verknüpften Dokument, um neue CORS-Regeln für Ihr Cosmos DB-Konto zu erstellen.

### <a name="install-this-package"></a>Installieren dieses Pakets

```Bash
npm install @azure/cosmos
```

### <a name="get-account-credentials"></a>Abrufen von Kontoanmeldeinformationen

Sie benötigen Ihren Cosmos DB-**Kontoendpunkt** und -**Schlüssel**. Sie können diese Elemente im [Azure-Portal](https://portal.azure.com/#blade/hubsextension/browseresource/resourcetype/microsoft.documentdb%2fdatabaseaccounts) finden oder dazu den [Azure CLI][azure_cli]-Codeausschnitt unten verwenden. Der Ausschnitt ist für die Bash-Shell formatiert.

```Bash
az cosmosdb show --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
az cosmosdb keys list --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
```

### <a name="create-an-instance-of-cosmosclient"></a>Erstellen einer Instanz von `CosmosClient`

Die Interaktion mit Cosmos DB beginnt mit einer Instanz der [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest)-Klasse.

```js
const { CosmosClient } = require("@azure/cosmos");

const endpoint = "https://your-account.documents.azure.com";
const key = "<database account masterkey>";
const client = new CosmosClient({ endpoint, key });

async function main() {
  // The rest of the README samples are designed to be pasted into this function body
}

main().catch((error) => {
  console.error(error);
});
```

Der Einfachkeit halber haben wir die Elemente `key` und `endpoint` in den Code direkt eingezogen. Wahrscheinlich möchten Sie sie aber aus einer in der Quellcodeverwaltung nicht enthaltenen Datei mithilfe eines Projekts wie [dotenv](https://www.npmjs.com/package/dotenv) oder aus Umgebungsvariablen laden.

In Produktionsumgebungen sollten Geheimnisse wie Schlüssel in [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) gespeichert werden.

## <a name="key-concepts"></a>Wichtige Begriffe

Sobald Sie einen [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-lates) initialisiert haben, können Sie mit den primären Ressourcentypen in Cosmos DB interagieren:

- [Datenbank:](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest) Ein Cosmos DB-Konto kann mehrere Datenbanken enthalten. Wenn Sie eine Datenbank erstellen, geben Sie die API an, die Sie bei der Interaktion mit deren Dokumenten verwenden möchten: SQL, MongoDB, Gremlin, Cassandra oder Azure Table. Verwenden Sie das Objekt [Datenbank](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest) zum Verwalten Ihrer Container.

- [Container:](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest) Ein Container ist eine Sammlung von JSON-Dokumenten. Sie erstellen (fügen ein), lesen, aktualisieren und löschen Elemente in einem Container mithilfe von Methoden für das Objekt [Container](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest).

- [Item:](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest) Ein Element ist ein in einem Container gespeichertes JSON-Dokument. Jedes Element muss einen `id`-Schlüssel mit einem Wert enthalten, der es im Container eindeutig identifiziert. Wenn Sie keinen `id` angeben, generiert das SDK einen automatisch.

Weitere Informationen zu diesen Ressourcen finden Sie unter [Arbeiten mit Azure Cosmos-Datenbanken, -Containern und -Elementen][cosmos_resources].

## <a name="examples"></a>Beispiele

Die folgenden Abschnitte enthalten mehrere Codeausschnitte zu einigen der häufigsten Cosmos DB-Aufgaben, darunter:

- [Erstellen einer Datenbank](#create-a-database)
- [Container erstellen](#create-a-container)
- [Einfügen von Elementen](#insert-items)
- [Abfragedokumente](#query-the-database)
- [Lesen eines Elements](#read-an-item)
- [Löschen eines Elements](#delete-an-data)

### <a name="create-a-database"></a>Erstellen einer Datenbank

Nach der Authentifizierung Ihres [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest) können Sie mit jeder beliebigen Ressource im Konto arbeiten. Der Codeausschnitt unten erstellt eine SQL API-Datenbank.

```js
const { database } = await client.databases.createIfNotExists({ id: "Test Database" });
console.log(database.id);
```

### <a name="create-a-container"></a>Erstellen eines Containers

In diesem Beispiel wird ein Container mit Standardeinstellungen erstellt.

```js
const { container } = await database.containers.createIfNotExists({ id: "Test Database" });
console.log(container.id);
```

### <a name="insert-items"></a>Einfügen von Elementen

Wenn Sie Elemente in einen Container einfügen möchten, übergeben Sie ein Objekt, das Ihre Daten enthält, an [Items.upsert](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#upsert-t--requestoptions-). Der Cosmos DB-Dienst erfordert, dass es zu jedem Element einen `id`-Schlüssel gibt. Wenn Sie keinen angeben, generiert das SDK einen `id` automatisch.

In diesem Beispiel werden mehrere Elemente in den Container eingefügt.

```js
const cities = [
  { id: "1", name: "Olympia", state: "WA", isCapitol: true },
  { id: "2", name: "Redmond", state: "WA", isCapitol: false },
  { id: "3", name: "Chicago", state: "IL", isCapitol: false }
];
for (const city of cities) {
  container.items.create(city);
}
```

### <a name="read-an-item"></a>Lesen eines Elements

Mithilfe von [Item.read](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#read-requestoptions-) können Sie ein einzelnes Element aus einem Container lesen. Dieser Vorgang ist kostengünstiger als die Verwendung von SQL zum Abfragen nach `id`.

```js
await container.item("1").read();
```

### <a name="delete-an-item"></a>Löschen eines Elements

Mithilfe von [Item.delete](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#delete-requestoptions-) können Sie Elemente aus einem Container löschen.

```js
// Delete the first item returned by the query above
await container.item("1").delete();
```

### <a name="query-the-database"></a>Abfragen der Datenbank

Eine Cosmos DB-SQL-API-Datenbank unterstützt das Abfragen der Elemente in einem Container mit [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-), wobei eine SQL-ähnliche Syntax verwendet wird:

```js
const { resources } = await container.items
  .query("SELECT * from c WHERE c.isCapitol = true")
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

Führen Sie parametrisierte Abfragen aus, indem Sie ein Objekt, das die Parameter und deren Werte enthält, an [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-) übergeben:

```js
const { resources } = await container.items
  .query({
    query: "SELECT * from c WHERE c.isCapitol = @isCapitol",
    parameters: [{ name: "@isCapitol", value: true }]
  })
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

Weitere Informationen zum Abfragen von Cosmos DB-Datenbanken mithilfe der SQL-API finden Sie unter [Abfragen von Azure Cosmos DB-Daten mit SQL Abfragen][cosmos_sql_queries].

## <a name="troubleshooting"></a>Problembehandlung

### <a name="general"></a>Allgemein

Wenn Sie mit Cosmos DB interagieren, entsprechen die vom Dienst zurückgegebenen Fehler den HTTP-Statuscodes, die bei REST-API-Anforderungen zurückgegeben werden.

[HTTP-Statuscodes für Azure Cosmos DB][cosmos_http_status_codes]

#### <a name="conflicts"></a>Konflikte

Wenn Sie beispielsweise versuchen, ein Element mithilfe einer in Ihrer Cosmos DB-Datenbank bereits verwendeten `id` zu erstellen, wird ein `409`-Fehler zurückgegeben, der den Konflikt angibt. Im folgenden Codeausschnitt wird der Fehler ordnungsgemäß behandelt, indem die Ausnahme abgefangen wird und zusätzliche Fehlerinformationen angezeigt werden.

```js
try {
  await containers.items.create({ id: "existing-item-id" });
} catch (error) {
  if (error.code === 409) {
    console.log("There was a conflict with an existing item");
  }
}
```

### <a name="transpiling"></a>Transpilierung

Die Azure SDKs sind so konzipiert, dass ES5 JavaScript-Syntax und [LTS-Versionen von Node.js](https://nodejs.org/about/releases/) unterstützt werden. Wenn Sie Unterstützung für frühere JavaScript-Runtimes wie Internet Explorer oder Node 6 benötigen, müssen Sie den SDK-Code im Rahmen ihres Buildvorgangs transpilieren.

### <a name="handle-transient-errors-with-retries"></a>Behandeln von vorübergehenden Fehlern mit Wiederholungen

Bei Ihrer Arbeit mit Cosmos DB kann es zu vorübergehenden Fehlern kommen. Sie können auf durch den Dienst erzwungene [Ratenlimits][cosmos_request_units] oder andere vorübergehende Probleme (z. B. Netzwerkausfälle) zurückzuführen sein. Informationen zur Behandlung solcher Fehler finden Sie im Leitfaden für Cloudentwurfsmuster unter [Wiederholungsmuster][azure_pattern_retry] sowie unter dem dazugehörigen [Trennschalter-Muster][azure_pattern_circuit_breaker].

## <a name="next-steps"></a>Nächste Schritte

### <a name="more-sample-code"></a>Weiterer Beispielcode

Im GitHub-Repository des SDKs sind [mehrere Beispiele][cosmos_samples] für Sie verfügbar. Diese Beispiele enthalten Beispielcode für weitere gängige Szenarien im Zusammenhang mit Cosmos DB:

- Datenbankvorgänge
- Containervorgänge
- Elementvorgänge
- Konfigurieren der Indizierung
- Lesen eines Container-Änderungsfeeds
- Gespeicherte Prozeduren
- Ändern von Datenbank-/Container-Durchsatzeinstellungen
- Schreibvorgänge in mehreren Regionen

### <a name="additional-documentation"></a>Zusätzliche Dokumentation

Eine ausführlichere Dokumentation zum Cosmos DB-Dienst finden Sie unter „docs.microsoft.com“ in der [Azure Cosmos DB-Dokumentation][cosmos_docs].

## <a name="useful-links"></a>Nützliche Links

- [Willkommen bei Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/community)
- [Schnellstart](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-get-started)
- [Tutorial](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-application)
- [Beispiele](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples)
- [Einführung in das Ressourcenmodell von Azure Cosmos DB-Dienst](https://docs.microsoft.com/azure/cosmos-db/sql-api-resources)
- [Einführung in die SQL-API von Azure Cosmos DB-Dienst](https://docs.microsoft.com/azure/cosmos-db/sql-api-sql-query)
- [Partitionierung](https://docs.microsoft.com/azure/cosmos-db/sql-api-partition-data)
- [API-Dokumentation](https://docs.microsoft.com/javascript/api/%40azure/cosmos/?view=azure-node-latest)

## <a name="contributing"></a>Mitwirken

Wenn Sie an dieser Bibliothek mitwirken möchten, lesen Sie die [Anleitung für Mitwirkende](https://github.com/Azure/azure-sdk-for-js/blob/main/CONTRIBUTING.md), um mehr darüber zu erfahren, wie Sie den Code erstellen und testen können.

![Aufrufe](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fcosmosdb%2Fcosmos%2FREADME.png)

<!-- LINKS -->

[azure_cli]: https://docs.microsoft.com/cli/azure
[azure_pattern_circuit_breaker]: https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker
[azure_pattern_retry]: https://docs.microsoft.com/azure/architecture/patterns/retry
[azure_portal]: https://portal.azure.com
[azure_sub]: https://azure.microsoft.com/free/
[cloud_shell]: https://docs.microsoft.com/azure/cloud-shell/overview
[cloud_shell_bash]: https://shell.azure.com/bash
[cosmos_account_create]: https://docs.microsoft.com/azure/cosmos-db/how-to-manage-database-account
[cosmos_account]: https://docs.microsoft.com/azure/cosmos-db/account-overview
[cosmos_container]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-containers
[cosmos_database]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-databases
[cosmos_docs]: https://docs.microsoft.com/azure/cosmos-db/
[cosmos_http_status_codes]: https://docs.microsoft.com/rest/api/cosmos-db/http-status-codes-for-cosmosdb
[cosmos_item]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-items
[cosmos_request_units]: https://docs.microsoft.com/azure/cosmos-db/request-units
[cosmos_resources]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items
[cosmos_samples]: https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples
[cosmos_sql_queries]: https://docs.microsoft.com/azure/cosmos-db/how-to-sql-query
[cosmos_ttl]: https://docs.microsoft.com/azure/cosmos-db/time-to-live
[npm]: https://www.npmjs.com/package/@azure/cosmos
